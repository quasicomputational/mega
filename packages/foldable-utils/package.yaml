name: q4c12-foldable-utils
version: "0"
homepage: https://github.com/quasicomputational/mega/tree/master/packages/foldable-utils
github: quasicomputational/mega
author: quasicomputational <quasicomputational@gmail.com>
license: BSD2
license-file:
  - LICENSE.BSD2

#TODO: replace with hpack's defaulting mechanism, once that has support for local files
<<: !include "../../defaults.yaml"

_common-dependencies:
  # Define version ranges once and only once across components.
  - &d-base
    "base >= 4.9.1.0 && < 4.11"
  - &d-bifunctors
    "bifunctors >= 5.4.2 && < 5.5"
  - &d-cabal-doctest
    "cabal-doctest >= 1.0.3 && < 1.1"
  - &d-doctest
    "doctest >= 0.11.4 && < 0.14"
  - &d-transformers
    "transformers >= 0.5 && < 0.6"

custom-setup:
  dependencies:
    #TODO: remove Cabal dep once https://github.com/haskell/cabal/issues/4288 is fixed
    - "Cabal"
    - *d-base
    - *d-cabal-doctest

library:
  source-dirs:
    - src
  exposed-modules:
    - Q4C12.FoldableUtils
  # Suppress Paths_*
  other-modules: []
  dependencies:
    - *d-base
    - *d-transformers
  when:
    - condition: impl(ghc < 8.2)
      dependencies:
        - *d-bifunctors

tests:
  doctests:
    source-dirs:
      - test
    main: Doctest.hs
    #Suppress Paths_*
    other-modules:
      []
    #TODO: Build_doctests ought to be listed as an autogen-module and an other-module, but hpack doesn't know about autogen modules: https://github.com/sol/hpack/issues/207
    ghc-options:
      #TODO: this is needed because cabal-doctest generates a module that triggers this warning. Sigh. Should file a bug about that...
      - "-Wno-missing-import-lists"
    when:
      condition: impl(ghc >= 8.2)
      ghc-options:
        #And this one is as a result of the Build_doctests hack above. TODO: if the hack lasts long enough that 8.0 is out of the support window, remove this check.
        - "-Wno-missing-home-modules"
        #Have to specify this one in the conditional because of https://github.com/sol/hpack/issues/255 TODO remove once fixed
        - "-Wno-missing-import-lists"
    dependencies:
      #https://github.com/phadej/cabal-doctest/issues/19
      - q4c12-foldable-utils
      - *d-base
      - *d-doctest
